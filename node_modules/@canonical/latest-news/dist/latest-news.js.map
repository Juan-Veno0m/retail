{"version":3,"file":"latest-news.js","sources":["../src/index.js"],"sourcesContent":["function revealSection() {\n  var latestNewsSection = document.querySelector(\"[data-js='latest-news']\");\n\n  if (latestNewsSection) {\n    latestNewsSection.classList.remove(\"u-hide\");\n  }\n}\n\nfunction formatDate(date) {\n  var parsedDate = new Date(date);\n  var monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n  return parsedDate.getDate() + \" \" + monthNames[parsedDate.getMonth()] + \" \" + parsedDate.getFullYear();\n}\n\nfunction articleDiv(article, articleTemplateSelector, options) {\n  var articleFragment = getTemplate(articleTemplateSelector);\n  var time = articleFragment.querySelector(\".article-time\");\n  var link = articleFragment.querySelector(\".article-link\");\n  var title = articleFragment.querySelector(\".article-title\");\n  var image = articleFragment.querySelector(\".article-image\");\n  var author = articleFragment.querySelector(\".article-author\");\n  var url = \"\";\n  var imageLink = document.createElement(\"a\");\n\n  if (options.hostname) {\n    url = \"https://\" + options.hostname;\n  }\n\n  var articleImage;\n\n  if (article._embedded && article._embedded[\"wp:featuredmedia\"] && article._embedded[\"wp:featuredmedia\"][0] && article._embedded[\"wp:featuredmedia\"][0].media_details && article._embedded[\"wp:featuredmedia\"][0].media_details.width && article._embedded[\"wp:featuredmedia\"][0].media_details.height) {\n    var media = article._embedded[\"wp:featuredmedia\"][0];\n    articleImage = {\n      url: media.source_url,\n      alt: media.alt_text,\n      width: media.media_details.width,\n      height: media.media_details.height\n    };\n  }\n\n  if (author) {\n    author.innerHTML = article.author.name;\n  }\n\n  if (time) {\n    time.setAttribute(\"datetime\", article.date);\n    time.innerText = formatDate(article.date);\n  }\n\n  if (link) {\n    link.href = url + \"/blog/\" + article.slug;\n\n    if (options.gtmEventLabel) {\n      link.onclick = function () {\n        dataLayer.push({\n          event: \"GAEvent\",\n          eventCategory: \"blog\",\n          eventAction: options.gtmEventLabel + \" news link\",\n          eventLabel: article.slug\n        });\n      };\n    }\n  }\n\n  if (title) {\n    title.innerHTML = article.title.rendered;\n  }\n\n  if (image && articleImage && options.linkImage) {\n    imageLink.href = url + \"/blog/\" + article.slug;\n    image.appendChild(imageLink);\n  }\n\n  if (image && articleImage) {\n    var img = document.createElement(\"img\");\n    img.setAttribute(\"src\", articleImage.url);\n    img.setAttribute(\"alt\", articleImage.alt);\n    img.setAttribute(\"width\", articleImage.width);\n    img.setAttribute(\"height\", articleImage.height);\n\n    if (options.linkImage) {\n      imageLink.appendChild(img);\n    } else {\n      image.appendChild(img);\n    }\n  }\n\n  return articleFragment;\n}\n\nfunction getTemplate(selector) {\n  var template = document.querySelector(selector);\n  var fragment;\n\n  if (\"content\" in template) {\n    fragment = document.importNode(template.content, true);\n  } else {\n    fragment = document.createDocumentFragment();\n\n    for (var i = 0; i < template.childNodes.length; i++) {\n      fragment.appendChild(template.childNodes[i].cloneNode(true));\n    }\n  }\n\n  return fragment;\n}\n\nfunction latestArticlesCallback(options) {\n  return function (event) {\n    var articlesContainer = document.querySelector(options.articlesContainerSelector);\n\n    if (articlesContainer) {\n      while (articlesContainer.hasChildNodes()) {\n        articlesContainer.removeChild(articlesContainer.lastChild);\n      }\n\n      var data = JSON.parse(event.target.responseText);\n\n      if (\"spotlightContainerSelector\" in options) {\n        var spotlightContainer = document.querySelector(options.spotlightContainerSelector);\n\n        if (spotlightContainer) {\n          var latestPinned = data.latest_pinned_articles[0];\n\n          if (latestPinned) {\n            spotlightContainer.appendChild(articleDiv(latestPinned, options.spotlightTemplateSelector, options));\n          }\n        } else {\n          console.warn(\"latest-news: No spotlight container found\");\n        }\n      }\n\n      if (data.latest_articles) {\n        data.latest_articles.forEach(function (article) {\n          articlesContainer.appendChild(articleDiv(article, options.articleTemplateSelector, options));\n        });\n      }\n    } else {\n      console.warn(\"latest-news: No articles container found\");\n    }\n  };\n}\n\nfunction fetchLatestNews(options) {\n  var url = \"https://ubuntu.com/blog/latest-news\";\n  var params = [];\n  revealSection();\n\n  if (options.limit) {\n    params.push(\"limit=\" + options.limit);\n  }\n\n  if (options.tagId) {\n    params.push(\"tag-id=\" + options.tagId);\n  }\n\n  if (options.groupId) {\n    params.push(\"group-id=\" + options.groupId);\n  }\n\n  if (params.length) {\n    url += \"?\" + params.join(\"&\");\n  }\n\n  var oReq = new XMLHttpRequest();\n  oReq.addEventListener(\"load\", latestArticlesCallback(options));\n  oReq.open(\"GET\", url);\n  oReq.send();\n}\n\nif (typeof window.fetchLatestNews == \"undefined\") {\n  window.fetchLatestNews = fetchLatestNews;\n}\n\nexport { articleDiv, fetchLatestNews, formatDate, getTemplate, latestArticlesCallback, revealSection };\n//# sourceMappingURL=index.js.map\n"],"names":["revealSection","latestNewsSection","document","formatDate","date","parsedDate","Date"],"mappings":"iDAAA,SAAAA,QACMC,EAAoBC,SAAAA,cAAxB,2BAEAD,GACEA,EAAAA,UAAAA,OAAAA,UAIJ,SAAAE,EAAAC,GACMC,EAAa,IAAAC,KAAjBF,0BACA,CAAA,UAAA,WAAA,QAAA,QAAA,MAAA,OAAA,OAAA,SAAA,YAAA,UAAA,WAAA"}